!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).nx=n()}}(function(){return function s(o,a,u){function l(t,n){if(!a[t]){if(!o[t]){var e="function"==typeof require&&require;if(!n&&e)return e(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};o[t][0].call(i.exports,function(n){return l(o[t][1][n]||n)},i,i.exports,s,o,a,u)}return a[t].exports}for(var c="function"==typeof require&&require,n=0;n<u.length;n++)l(u[n]);return l}({1:[function(n,Q,X){(function(J){!function(){var n="object"==typeof self&&self.self===self&&self||"object"==typeof J&&J.global===J&&J||this||{},t=n._,r=Array.prototype,o=Object.prototype,f="undefined"!=typeof Symbol?Symbol.prototype:null,i=r.push,u=r.slice,h=o.toString,s=o.hasOwnProperty,e=Array.isArray,a=Object.keys,l=Object.create,c=function(){},p=function(n){return n instanceof p?n:this instanceof p?void(this._wrapped=n):new p(n)};void 0===X||X.nodeType?n._=p:(void 0!==Q&&!Q.nodeType&&Q.exports&&(X=Q.exports=p),X._=p),p.VERSION="1.9.1";var y,d=function(i,s,n){if(void 0===s)return i;switch(null==n?3:n){case 1:return function(n){return i.call(s,n)};case 3:return function(n,t,e){return i.call(s,n,t,e)};case 4:return function(n,t,e,r){return i.call(s,n,t,e,r)}}return function(){return i.apply(s,arguments)}},m=function(n,t,e){return p.iteratee!==y?p.iteratee(n,t):null==n?p.identity:p.isFunction(n)?d(n,t,e):p.isObject(n)&&!p.isArray(n)?p.matcher(n):p.property(n)};p.iteratee=y=function(n,t){return m(n,t,1/0)};var v=function(i,s){return s=null==s?i.length-1:+s,function(){for(var n=Math.max(arguments.length-s,0),t=Array(n),e=0;e<n;e++)t[e]=arguments[e+s];switch(s){case 0:return i.call(this,t);case 1:return i.call(this,arguments[0],t);case 2:return i.call(this,arguments[0],arguments[1],t)}var r=Array(s+1);for(e=0;e<s;e++)r[e]=arguments[e];return r[s]=t,i.apply(this,r)}},k=function(n){if(!p.isObject(n))return{};if(l)return l(n);c.prototype=n;var t=new c;return c.prototype=null,t},g=function(t){return function(n){return null==n?void 0:n[t]}},b=function(n,t){return null!=n&&s.call(n,t)},w=function(n,t){for(var e=t.length,r=0;r<e;r++){if(null==n)return;n=n[t[r]]}return e?n:void 0},_=Math.pow(2,53)-1,T=g("length"),x=function(n){var t=T(n);return"number"==typeof t&&0<=t&&t<=_};p.each=p.forEach=function(n,t,e){var r,i;if(t=d(t,e),x(n))for(r=0,i=n.length;r<i;r++)t(n[r],r,n);else{var s=p.keys(n);for(r=0,i=s.length;r<i;r++)t(n[s[r]],s[r],n)}return n},p.map=p.collect=function(n,t,e){t=m(t,e);for(var r=!x(n)&&p.keys(n),i=(r||n).length,s=Array(i),o=0;o<i;o++){var a=r?r[o]:o;s[o]=t(n[a],a,n)}return s};var A=function(u){return function(n,t,e,r){var i=3<=arguments.length;return function(n,t,e,r){var i=!x(n)&&p.keys(n),s=(i||n).length,o=0<u?0:s-1;for(r||(e=n[i?i[o]:o],o+=u);0<=o&&o<s;o+=u){var a=i?i[o]:o;e=t(e,n[a],a,n)}return e}(n,d(t,r,4),e,i)}};p.reduce=p.foldl=p.inject=A(1),p.reduceRight=p.foldr=A(-1),p.find=p.detect=function(n,t,e){var r=(x(n)?p.findIndex:p.findKey)(n,t,e);if(void 0!==r&&-1!==r)return n[r]},p.filter=p.select=function(n,r,t){var i=[];return r=m(r,t),p.each(n,function(n,t,e){r(n,t,e)&&i.push(n)}),i},p.reject=function(n,t,e){return p.filter(n,p.negate(m(t)),e)},p.every=p.all=function(n,t,e){t=m(t,e);for(var r=!x(n)&&p.keys(n),i=(r||n).length,s=0;s<i;s++){var o=r?r[s]:s;if(!t(n[o],o,n))return!1}return!0},p.some=p.any=function(n,t,e){t=m(t,e);for(var r=!x(n)&&p.keys(n),i=(r||n).length,s=0;s<i;s++){var o=r?r[s]:s;if(t(n[o],o,n))return!0}return!1},p.contains=p.includes=p.include=function(n,t,e,r){return x(n)||(n=p.values(n)),("number"!=typeof e||r)&&(e=0),0<=p.indexOf(n,t,e)},p.invoke=v(function(n,e,r){var i,s;return p.isFunction(e)?s=e:p.isArray(e)&&(i=e.slice(0,-1),e=e[e.length-1]),p.map(n,function(n){var t=s;if(!t){if(i&&i.length&&(n=w(n,i)),null==n)return;t=n[e]}return null==t?t:t.apply(n,r)})}),p.pluck=function(n,t){return p.map(n,p.property(t))},p.where=function(n,t){return p.filter(n,p.matcher(t))},p.findWhere=function(n,t){return p.find(n,p.matcher(t))},p.max=function(n,r,t){var e,i,s=-1/0,o=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n)for(var a=0,u=(n=x(n)?n:p.values(n)).length;a<u;a++)null!=(e=n[a])&&s<e&&(s=e);else r=m(r,t),p.each(n,function(n,t,e){i=r(n,t,e),(o<i||i===-1/0&&s===-1/0)&&(s=n,o=i)});return s},p.min=function(n,r,t){var e,i,s=1/0,o=1/0;if(null==r||"number"==typeof r&&"object"!=typeof n[0]&&null!=n)for(var a=0,u=(n=x(n)?n:p.values(n)).length;a<u;a++)null!=(e=n[a])&&e<s&&(s=e);else r=m(r,t),p.each(n,function(n,t,e){((i=r(n,t,e))<o||i===1/0&&s===1/0)&&(s=n,o=i)});return s},p.shuffle=function(n){return p.sample(n,1/0)},p.sample=function(n,t,e){if(null==t||e)return x(n)||(n=p.values(n)),n[p.random(n.length-1)];var r=x(n)?p.clone(n):p.values(n),i=T(r);t=Math.max(Math.min(t,i),0);for(var s=i-1,o=0;o<t;o++){var a=p.random(o,s),u=r[o];r[o]=r[a],r[a]=u}return r.slice(0,t)},p.sortBy=function(n,r,t){var i=0;return r=m(r,t),p.pluck(p.map(n,function(n,t,e){return{value:n,index:i++,criteria:r(n,t,e)}}).sort(function(n,t){var e=n.criteria,r=t.criteria;if(e!==r){if(r<e||void 0===e)return 1;if(e<r||void 0===r)return-1}return n.index-t.index}),"value")};var S=function(o,t){return function(r,i,n){var s=t?[[],[]]:{};return i=m(i,n),p.each(r,function(n,t){var e=i(n,t,r);o(s,n,e)}),s}};p.groupBy=S(function(n,t,e){b(n,e)?n[e].push(t):n[e]=[t]}),p.indexBy=S(function(n,t,e){n[e]=t}),p.countBy=S(function(n,t,e){b(n,e)?n[e]++:n[e]=1});var E=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;p.toArray=function(n){return n?p.isArray(n)?u.call(n):p.isString(n)?n.match(E):x(n)?p.map(n,p.identity):p.values(n):[]},p.size=function(n){return null==n?0:x(n)?n.length:p.keys(n).length},p.partition=S(function(n,t,e){n[e?0:1].push(t)},!0),p.first=p.head=p.take=function(n,t,e){return null==n||n.length<1?null==t?void 0:[]:null==t||e?n[0]:p.initial(n,n.length-t)},p.initial=function(n,t,e){return u.call(n,0,Math.max(0,n.length-(null==t||e?1:t)))},p.last=function(n,t,e){return null==n||n.length<1?null==t?void 0:[]:null==t||e?n[n.length-1]:p.rest(n,Math.max(0,n.length-t))},p.rest=p.tail=p.drop=function(n,t,e){return u.call(n,null==t||e?1:t)},p.compact=function(n){return p.filter(n,Boolean)};var N=function(n,t,e,r){for(var i=(r=r||[]).length,s=0,o=T(n);s<o;s++){var a=n[s];if(x(a)&&(p.isArray(a)||p.isArguments(a)))if(t)for(var u=0,l=a.length;u<l;)r[i++]=a[u++];else N(a,t,e,r),i=r.length;else e||(r[i++]=a)}return r};p.flatten=function(n,t){return N(n,t,!1)},p.without=v(function(n,t){return p.difference(n,t)}),p.uniq=p.unique=function(n,t,e,r){p.isBoolean(t)||(r=e,e=t,t=!1),null!=e&&(e=m(e,r));for(var i=[],s=[],o=0,a=T(n);o<a;o++){var u=n[o],l=e?e(u,o,n):u;t&&!e?(o&&s===l||i.push(u),s=l):e?p.contains(s,l)||(s.push(l),i.push(u)):p.contains(i,u)||i.push(u)}return i},p.union=v(function(n){return p.uniq(N(n,!0,!0))}),p.intersection=function(n){for(var t=[],e=arguments.length,r=0,i=T(n);r<i;r++){var s=n[r];if(!p.contains(t,s)){var o;for(o=1;o<e&&p.contains(arguments[o],s);o++);o===e&&t.push(s)}}return t},p.difference=v(function(n,t){return t=N(t,!0,!0),p.filter(n,function(n){return!p.contains(t,n)})}),p.unzip=function(n){for(var t=n&&p.max(n,T).length||0,e=Array(t),r=0;r<t;r++)e[r]=p.pluck(n,r);return e},p.zip=v(p.unzip),p.object=function(n,t){for(var e={},r=0,i=T(n);r<i;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e};var j=function(s){return function(n,t,e){t=m(t,e);for(var r=T(n),i=0<s?0:r-1;0<=i&&i<r;i+=s)if(t(n[i],i,n))return i;return-1}};p.findIndex=j(1),p.findLastIndex=j(-1),p.sortedIndex=function(n,t,e,r){for(var i=(e=m(e,r,1))(t),s=0,o=T(n);s<o;){var a=Math.floor((s+o)/2);e(n[a])<i?s=a+1:o=a}return s};var I=function(s,o,a){return function(n,t,e){var r=0,i=T(n);if("number"==typeof e)0<s?r=0<=e?e:Math.max(e+i,r):i=0<=e?Math.min(e+1,i):e+i+1;else if(a&&e&&i)return n[e=a(n,t)]===t?e:-1;if(t!=t)return 0<=(e=o(u.call(n,r,i),p.isNaN))?e+r:-1;for(e=0<s?r:i-1;0<=e&&e<i;e+=s)if(n[e]===t)return e;return-1}};p.indexOf=I(1,p.findIndex,p.sortedIndex),p.lastIndexOf=I(-1,p.findLastIndex),p.range=function(n,t,e){null==t&&(t=n||0,n=0),e||(e=t<n?-1:1);for(var r=Math.max(Math.ceil((t-n)/e),0),i=Array(r),s=0;s<r;s++,n+=e)i[s]=n;return i},p.chunk=function(n,t){if(null==t||t<1)return[];for(var e=[],r=0,i=n.length;r<i;)e.push(u.call(n,r,r+=t));return e};var O=function(n,t,e,r,i){if(!(r instanceof t))return n.apply(e,i);var s=k(n.prototype),o=n.apply(s,i);return p.isObject(o)?o:s};p.bind=v(function(t,e,r){if(!p.isFunction(t))throw new TypeError("Bind must be called on a function");var i=v(function(n){return O(t,i,e,this,r.concat(n))});return i}),p.partial=v(function(i,s){var o=p.partial.placeholder,a=function(){for(var n=0,t=s.length,e=Array(t),r=0;r<t;r++)e[r]=s[r]===o?arguments[n++]:s[r];for(;n<arguments.length;)e.push(arguments[n++]);return O(i,a,this,this,e)};return a}),(p.partial.placeholder=p).bindAll=v(function(n,t){var e=(t=N(t,!1,!1)).length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var r=t[e];n[r]=p.bind(n[r],n)}}),p.memoize=function(r,i){var s=function(n){var t=s.cache,e=""+(i?i.apply(this,arguments):n);return b(t,e)||(t[e]=r.apply(this,arguments)),t[e]};return s.cache={},s},p.delay=v(function(n,t,e){return setTimeout(function(){return n.apply(null,e)},t)}),p.defer=p.partial(p.delay,p,1),p.throttle=function(e,r,i){var s,o,a,u,l=0;i||(i={});var c=function(){l=!1===i.leading?0:p.now(),s=null,u=e.apply(o,a),s||(o=a=null)},n=function(){var n=p.now();l||!1!==i.leading||(l=n);var t=r-(n-l);return o=this,a=arguments,t<=0||r<t?(s&&(clearTimeout(s),s=null),l=n,u=e.apply(o,a),s||(o=a=null)):s||!1===i.trailing||(s=setTimeout(c,t)),u};return n.cancel=function(){clearTimeout(s),l=0,s=o=a=null},n},p.debounce=function(e,r,i){var s,o,a=function(n,t){s=null,t&&(o=e.apply(n,t))},n=v(function(n){if(s&&clearTimeout(s),i){var t=!s;s=setTimeout(a,r),t&&(o=e.apply(this,n))}else s=p.delay(a,r,this,n);return o});return n.cancel=function(){clearTimeout(s),s=null},n},p.wrap=function(n,t){return p.partial(t,n)},p.negate=function(n){return function(){return!n.apply(this,arguments)}},p.compose=function(){var e=arguments,r=e.length-1;return function(){for(var n=r,t=e[r].apply(this,arguments);n--;)t=e[n].call(this,t);return t}},p.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}},p.before=function(n,t){var e;return function(){return 0<--n&&(e=t.apply(this,arguments)),n<=1&&(t=null),e}},p.once=p.partial(p.before,2),p.restArguments=v;var C=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],P=function(n,t){var e=F.length,r=n.constructor,i=p.isFunction(r)&&r.prototype||o,s="constructor";for(b(n,s)&&!p.contains(t,s)&&t.push(s);e--;)(s=F[e])in n&&n[s]!==i[s]&&!p.contains(t,s)&&t.push(s)};p.keys=function(n){if(!p.isObject(n))return[];if(a)return a(n);var t=[];for(var e in n)b(n,e)&&t.push(e);return C&&P(n,t),t},p.allKeys=function(n){if(!p.isObject(n))return[];var t=[];for(var e in n)t.push(e);return C&&P(n,t),t},p.values=function(n){for(var t=p.keys(n),e=t.length,r=Array(e),i=0;i<e;i++)r[i]=n[t[i]];return r},p.mapObject=function(n,t,e){t=m(t,e);for(var r=p.keys(n),i=r.length,s={},o=0;o<i;o++){var a=r[o];s[a]=t(n[a],a,n)}return s},p.pairs=function(n){for(var t=p.keys(n),e=t.length,r=Array(e),i=0;i<e;i++)r[i]=[t[i],n[t[i]]];return r},p.invert=function(n){for(var t={},e=p.keys(n),r=0,i=e.length;r<i;r++)t[n[e[r]]]=e[r];return t},p.functions=p.methods=function(n){var t=[];for(var e in n)p.isFunction(n[e])&&t.push(e);return t.sort()};var D=function(u,l){return function(n){var t=arguments.length;if(l&&(n=Object(n)),t<2||null==n)return n;for(var e=1;e<t;e++)for(var r=arguments[e],i=u(r),s=i.length,o=0;o<s;o++){var a=i[o];l&&void 0!==n[a]||(n[a]=r[a])}return n}};p.extend=D(p.allKeys),p.extendOwn=p.assign=D(p.keys),p.findKey=function(n,t,e){t=m(t,e);for(var r,i=p.keys(n),s=0,o=i.length;s<o;s++)if(t(n[r=i[s]],r,n))return r};var M,B,H=function(n,t,e){return t in e};p.pick=v(function(n,t){var e={},r=t[0];if(null==n)return e;p.isFunction(r)?(1<t.length&&(r=d(r,t[1])),t=p.allKeys(n)):(r=H,t=N(t,!1,!1),n=Object(n));for(var i=0,s=t.length;i<s;i++){var o=t[i],a=n[o];r(a,o,n)&&(e[o]=a)}return e}),p.omit=v(function(n,e){var t,r=e[0];return p.isFunction(r)?(r=p.negate(r),1<e.length&&(t=e[1])):(e=p.map(N(e,!1,!1),String),r=function(n,t){return!p.contains(e,t)}),p.pick(n,r,t)}),p.defaults=D(p.allKeys,!0),p.create=function(n,t){var e=k(n);return t&&p.extendOwn(e,t),e},p.clone=function(n){return p.isObject(n)?p.isArray(n)?n.slice():p.extend({},n):n},p.tap=function(n,t){return t(n),n},p.isMatch=function(n,t){var e=p.keys(t),r=e.length;if(null==n)return!r;for(var i=Object(n),s=0;s<r;s++){var o=e[s];if(t[o]!==i[o]||!(o in i))return!1}return!0},M=function(n,t,e,r){if(n===t)return 0!==n||1/n==1/t;if(null==n||null==t)return!1;if(n!=n)return t!=t;var i=typeof n;return("function"===i||"object"===i||"object"==typeof t)&&B(n,t,e,r)},B=function(n,t,e,r){n instanceof p&&(n=n._wrapped),t instanceof p&&(t=t._wrapped);var i=h.call(n);if(i!==h.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!=+n?+t!=+t:0==+n?1/+n==1/t:+n==+t;case"[object Date]":case"[object Boolean]":return+n==+t;case"[object Symbol]":return f.valueOf.call(n)===f.valueOf.call(t)}var s="[object Array]"===i;if(!s){if("object"!=typeof n||"object"!=typeof t)return!1;var o=n.constructor,a=t.constructor;if(o!==a&&!(p.isFunction(o)&&o instanceof o&&p.isFunction(a)&&a instanceof a)&&"constructor"in n&&"constructor"in t)return!1}r=r||[];for(var u=(e=e||[]).length;u--;)if(e[u]===n)return r[u]===t;if(e.push(n),r.push(t),s){if((u=n.length)!==t.length)return!1;for(;u--;)if(!M(n[u],t[u],e,r))return!1}else{var l,c=p.keys(n);if(u=c.length,p.keys(t).length!==u)return!1;for(;u--;)if(l=c[u],!b(t,l)||!M(n[l],t[l],e,r))return!1}return e.pop(),r.pop(),!0},p.isEqual=function(n,t){return M(n,t)},p.isEmpty=function(n){return null==n||(x(n)&&(p.isArray(n)||p.isString(n)||p.isArguments(n))?0===n.length:0===p.keys(n).length)},p.isElement=function(n){return!(!n||1!==n.nodeType)},p.isArray=e||function(n){return"[object Array]"===h.call(n)},p.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},p.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){p["is"+t]=function(n){return h.call(n)==="[object "+t+"]"}}),p.isArguments(arguments)||(p.isArguments=function(n){return b(n,"callee")});var L=n.document&&n.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof L&&(p.isFunction=function(n){return"function"==typeof n||!1}),p.isFinite=function(n){return!p.isSymbol(n)&&isFinite(n)&&!isNaN(parseFloat(n))},p.isNaN=function(n){return p.isNumber(n)&&isNaN(n)},p.isBoolean=function(n){return!0===n||!1===n||"[object Boolean]"===h.call(n)},p.isNull=function(n){return null===n},p.isUndefined=function(n){return void 0===n},p.has=function(n,t){if(!p.isArray(t))return b(n,t);for(var e=t.length,r=0;r<e;r++){var i=t[r];if(null==n||!s.call(n,i))return!1;n=n[i]}return!!e},p.noConflict=function(){return n._=t,this},p.identity=function(n){return n},p.constant=function(n){return function(){return n}},p.noop=function(){},p.property=function(t){return p.isArray(t)?function(n){return w(n,t)}:g(t)},p.propertyOf=function(t){return null==t?function(){}:function(n){return p.isArray(n)?w(t,n):t[n]}},p.matcher=p.matches=function(t){return t=p.extendOwn({},t),function(n){return p.isMatch(n,t)}},p.times=function(n,t,e){var r=Array(Math.max(0,n));t=d(t,e,1);for(var i=0;i<n;i++)r[i]=t(i);return r},p.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},p.now=Date.now||function(){return(new Date).getTime()};var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},W=p.invert(q),U=function(t){var e=function(n){return t[n]},n="(?:"+p.keys(t).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(n){return n=null==n?"":""+n,r.test(n)?n.replace(i,e):n}};p.escape=U(q),p.unescape=U(W),p.result=function(n,t,e){p.isArray(t)||(t=[t]);var r=t.length;if(!r)return p.isFunction(e)?e.call(n):e;for(var i=0;i<r;i++){var s=null==n?void 0:n[t[i]];void 0===s&&(s=e,i=r),n=p.isFunction(s)?s.call(n):s}return n};var z=0;p.uniqueId=function(n){var t=++z+"";return n?n+t:t},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var G=/(.)^/,R={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\u2028|\u2029/g,$=function(n){return"\\"+R[n]};p.template=function(s,n,t){!n&&t&&(n=t),n=p.defaults({},n,p.templateSettings);var e,r=RegExp([(n.escape||G).source,(n.interpolate||G).source,(n.evaluate||G).source].join("|")+"|$","g"),o=0,a="__p+='";s.replace(r,function(n,t,e,r,i){return a+=s.slice(o,i).replace(K,$),o=i+n.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":e?a+="'+\n((__t=("+e+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),n}),a+="';\n",n.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{e=new Function(n.variable||"obj","_",a)}catch(n){throw n.source=a,n}var i=function(n){return e.call(this,n,p)},u=n.variable||"obj";return i.source="function("+u+"){\n"+a+"}",i},p.chain=function(n){var t=p(n);return t._chain=!0,t};var V=function(n,t){return n._chain?p(t).chain():t};p.mixin=function(e){return p.each(p.functions(e),function(n){var t=p[n]=e[n];p.prototype[n]=function(){var n=[this._wrapped];return i.apply(n,arguments),V(this,t.apply(p,n))}}),p},p.mixin(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=r[t];p.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],V(this,n)}}),p.each(["concat","join","slice"],function(n){var t=r[n];p.prototype[n]=function(){return V(this,t.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return String(this._wrapped)}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(n,t,e){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},r=function(){function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}}();var i=n("underscore"),u=n("./errors").NotatrixError;function o(n){if(n)return n.replace(/\s/g,"")}function l(n){n=o(n);var t=[];return i.each(n.split("|"),function(n){(n=n.split(":"))[0]&&t.push({token:n[0],deprel:n[1]})}),t}function c(n,t){"string"==typeof t&&a.test(t)&&(n.sentence.options.help.upostag&&!n.upostag&&(n.upostag="PUNCT"),n.sentence.options.help.xpostag&&!n.xpostag&&(n.xpostag="PUNCT"))}function f(n,t){var e=new Array(t).fill("\t").join(""),r=n.xpostag?" "+n.xpostag.replace(/;/g," "):"",i=n.misc?" "+n.misc.replace(/;/g," "):"",s=n.deprel?" @"+n.deprel:"",o=n.id?" #"+n.id+"->":"",a=o&&n.head?""+n.head:"",u=n.sentence.options.showEmptyDependencies||n.head?""+o+a:"";return e+'"'+n.lemma+'"'+r+i+s+u}var h="_",p=["form","lemma","upostag","xpostag","feats","head","deprel","deps","misc"],a=/[.,!?]/,y=function(){function a(n,e){var r=this;if(function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),!n)throw new u("missing required arg: Token");this.initializing=!0,this.token=n,this.sentence=n.sentence,this._heads=[],this._deps=[],this.id=null,this.subTokens=[],i.each(e,function(n,t){void 0===n||-1===p.indexOf(t)?delete e[t]:r[t]=n}),this.params=e||{},this.initializing=!1}return r(a,[{key:"getSubToken",value:function(n){return this.subTokens[n]||null}},{key:"insertSubTokenAt",value:function(n,t){if(n=parseFloat(n),isNaN(n))throw new u("unable to insert subToken: unable to cast index to int");if(!t)throw new u("unable to insert subToken: no subToken provided");if(t.__proto__!==this.token.__proto__)throw new u("unable to insert subToken: not instance of Token");if(t.isSuperToken)throw new u("unable to insert subToken: token has subTokens");if(t.isSubToken)throw new u("unable to insert subToken: token is already a subToken");if(this.isSubToken)throw new u("unable to insert subToken: this is already a subToken");return n=n<0?0:n>this.length?this.length:parseInt(n),(t.superToken=this).subTokens=this.subTokens.slice(0,n).concat(t).concat(this.subTokens.slice(n)),this}},{key:"removeSubTokenAt",value:function(e){var r=this;if(!this.length)return null;if(e=parseFloat(e),isNaN(e))throw new u("unable to remove subToken: unable to cast index to int");return e=e<0?0:e>this.length-1?this.length-1:parseInt(e),this.sentence.forEach(function(t){t.analysis.eachHead(function(n){n===r[e]&&t.analysis.removeHead(n)}).eachDep(function(n){n===r[e]&&t.analysis.removeDep(n)})}),this.subTokens[e].superToken=null,this.subTokens.splice(e,1)[0]}},{key:"moveSubTokenAt",value:function(n,t){if(n=parseFloat(n),t=parseFloat(t),isNaN(n)||isNaN(t))throw new u("unable to move subToken: unable to cast indices to ints");if((n=n<0?0:n>this.length-1?this.length-1:parseInt(n))===(t=t<0?0:t>this.length-1?this.length-1:parseInt(t)));else{var e=this.subTokens.splice(n,1);this.subTokens=this.subTokens.slice(0,t).concat(e).concat(this.subTokens.slice(t))}return this}},{key:"pushSubToken",value:function(n){return this.insertSubTokenAt(1/0,n)}},{key:"popSubToken",value:function(){return this.removeSubTokenAt(1/0)}},{key:"eachHead",value:function(e){return i.each(this._heads,function(n,t){e(n.token,n.deprel,t)}),this}},{key:"addHead",value:function(n,t){if(!(n instanceof a))throw new u("can't add head: not Analysis instance");return this.changeHead(n,t)||(1===this._heads.length&&"_"===this._heads[0].token&&(this._heads=[]),this._heads.push({token:n,deprel:t}),this.sentence.options.help.head&&n._deps.push({token:this,deprel:t})),this}},{key:"removeHead",value:function(r){var i=this;if(!(r instanceof a))throw new u("can't remove head: not Analysis instance");var s=-1;return this.eachHead(function(n,t,e){n===r&&(s=e)}),-1<s&&this._heads.splice(s,1),s=-1,this.sentence.options.help.head&&r.eachDep(function(n,t,e){n===i&&(s=e)}),-1<s&&r._deps.splice(s,1),this}},{key:"changeHead",value:function(r,i){var s=this;if(!(r instanceof a))throw new u("can't change head: not Analysis instance");var o=!1;return this.eachHead(function(n,t,e){n===r&&(s._heads[e].deprel=i||t,o=!0)}),this.sentence.options.help.head&&r.eachDep(function(n,t,e){n===s&&(r._deps[e].deprel=i||t)}),o?this:null}},{key:"eachDep",value:function(e){return i.each(this._deps,function(n,t){e(n.token,n.deprel,t)}),this}},{key:"addDep",value:function(n,t){if(!(n instanceof a))throw new u("can't add dep: not Analysis instance");return this.changeDep(n,t)||(1===this._deps.length&&"_"===this._deps[0].token&&(this._deps=[]),this._deps.push({token:n,deprel:t}),this.sentence.options.help.deps&&n._heads.push({token:this,deprel:t})),this}},{key:"removeDep",value:function(r){var i=this;if(!(r instanceof a))throw new u("can't remove dep: not Analysis instance");var s=-1;return this.eachDep(function(n,t,e){n===r&&(s=e)}),-1<s&&this._deps.splice(s,1),s=-1,this.sentence.options.help.deps&&r.eachHead(function(n,t,e){n===i&&(s=e)}),-1<s&&r._heads.splice(s,1),this}},{key:"changeDep",value:function(r,i){var s=this;if(!(r instanceof a))throw new u("can't change dep: not Analysis instance");var o=!1;return this.eachDep(function(n,t,e){n===r&&(s._deps[e].deprel=i||t,o=!0)}),this.sentence.options.help.deps&&r.eachHead(function(n,t,e){n===s&&(r._heads[e].deprel=i||t)}),o?this:null}},{key:"length",get:function(){return this.subTokens.length}},{key:"nx",get:function(){var t=this,e={};return i.each(p,function(n){e[n]=t[n]}),{id:this.id,num:this.num,params:this.params,values:e,subTokens:this.subTokens.map(function(n){return n.nx})}},set:function(n){var e=this;this.params=n.params,i.each(n.values,function(n,t){e[t]=n})}},{key:"text",get:function(){return this.form&&this.form!==h?this.form:this.lemma&&this.lemma!==h?this.lemma:this.sentence.fallbackOnText?h:""}},{key:"conllu",get:function(){var t=this;if(this.sentence.index(),null===this.id||void 0===this.id)throw new u("analysis is not currently indexed");return this.id+"\t"+i.map(p,function(n){return t[n]||h}).join("\t")}},{key:"cg3",get:function(){return this.sentence.index(),this.isSuperToken?this.subTokens.map(function(n,t){return f(n.analysis,t+1)}).join("\n"):f(this,1)}},{key:"eles",get:function(){var n,t,e=this,r=[];return this.isCurrent&&(this.isSuperToken?(r.push({data:{id:"multiword-"+this.id,num:this.num,clump:this.clump,name:"multiword",label:this.form+" "+(n=this.id,t={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","-":"₋","(":"₍",")":"₎"},n.split("").map(function(n){return t[n]||n}).join(""))},classes:"multiword"}),i.each(this.subTokens,function(n){r=r.concat(n.eles)})):(r.push({data:{id:"num-"+this.id,num:this.num,clump:this.clump,name:"number",label:this.id,pos:this.pos,parent:this.superToken?"multiword-"+this.superToken.id:void 0,analysis:this},classes:"number"},{data:{id:"form-"+this.id,num:this.num,clump:this.clump,name:"form",attr:"form",form:this.form,label:this.form,length:(3<this.form.length?.7*this.form.length:this.form.length)+"em",state:"normal",parent:"num-"+this.id,analysis:this},classes:"form"+(0==this.head?" root":"")},{data:{id:"pos-node-"+this.id,num:this.num,clump:this.clump,name:"pos-node",attr:"upostag",pos:this.pos,label:this.pos||"",length:.7*(this.pos||"").length+1+"em",analysis:this},classes:"pos"},{data:{id:"pos-edge-"+this.id,num:this.num,clump:this.clump,name:"pos-edge",pos:this.pos,source:"form-"+this.id,target:"pos-node-"+this.id},classes:"pos"}),this.eachHead(function(n,t){t=t||"",n&&n.id&&r.push({data:{id:"dep_"+e.id+"_"+n.id,name:"dependency",attr:"deprel",deprel:t,source:"form-"+e.id,sourceAnalysis:e,target:"form-"+n.id,targetAnalysis:n,length:t.length/3+"em",label:null,ctrl:null},classes:null})}))),r}},{key:"form",get:function(){return this.sentence.options.help.form?this._form||this._lemma:this._form},set:function(n){c(this,n=o(n)),this._form=n}},{key:"lemma",get:function(){return this.isSuperToken?null:this.sentence.options.help.lemma?this._lemma||this._form:this._lemma},set:function(n){c(this,n=o(n)),this._lemma=n}},{key:"pos",get:function(){return this.upostag||this.xpostag}},{key:"upostag",get:function(){return this.isSuperToken?null:this._upostag===h?null:this._upostag},set:function(n){this._upostag=o(n)}},{key:"xpostag",get:function(){return this.isSuperToken?null:this._xpostag===h?null:this._xpostag},set:function(n){this._xpostag=o(n)}},{key:"feats",get:function(){return this.isSuperToken?null:this._feats},set:function(n){this._feats=o(n)}},{key:"head",get:function(){var e=this;if(this.isSuperToken)return null;if(this.sentence.options.showEnhanced){var r=[];return this.eachHead(function(n,t){n!==e.sentence.getById(n.id)&&e.sentence.options.help.head?r.push(n+(t?":"+t:"")):r.push((n.id||n)+(t?":"+t:""))}),r.join("|")||null}return this._heads.length?this._heads[0].id||this._heads[0]:null},set:function(n){var t=this;"string"==typeof(n=n||[])&&(n=l(n)),this._heads=n.map(function(n){return t.initializing?{token:n.token,deprel:n.deprel}:{token:t.sentence.getById(n.token)||n.token,deprel:n.deprel}}).filter(function(n){if(n.token!==h)return n})}},{key:"deprel",get:function(){return this.isSuperToken?null:this._deprel},set:function(n){this._deprel=o(n)}},{key:"deps",get:function(){var e=this;if(this.isSuperToken)return null;var r=[];return this.eachDep(function(n,t){n!==e.sentence.getById(n.id)&&e.sentence.options.help.deps?r.push(n+(t?":"+t:"")):r.push((n.id||n)+(t?":"+t:""))}),r.join("|")||null},set:function(n){var t=this;"string"==typeof(n=n||[])&&(n=l(n)),this._deps=n.map(function(n){return t.initializing?{token:n.token,deprel:n.deprel}:{token:t.sentence.getById(n.token)||n.token,deprel:n.deprel}}).filter(function(n){if(n.token!==h)return n})}},{key:"misc",get:function(){return this._misc},set:function(n){this._misc=o(n)}},{key:"superToken",get:function(){return this.token.superToken}},{key:"isSubToken",get:function(){return null!==this.superToken}},{key:"isSuperToken",get:function(){return 0<this.subTokens.length}},{key:"isCurrent",get:function(){return this.token.analysis===this}}],[{key:"fromNx",value:function(n,t){var e=new a(n);return e.nx=t,e}}]),a}();y.prototype.__proto__=new Proxy(y.prototype.__proto__,{get:function(n,t,e){if("symbol"===(void 0===t?"undefined":s(t)))return this[t];var r=parseFloat(t);if(isNaN(r))return this[t];r=parseInt(r);var i=e.subTokens[r];return i?i.analysis:null}}),t.exports=y},{"./errors":3,underscore:1}],3:[function(n,t,e){"use strict";function s(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function o(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?n:t}function r(n,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var a=function(n){function i(){var n;s(this,i);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return o(this,(n=i.__proto__||Object.getPrototypeOf(i)).call.apply(n,[this].concat(e)))}return r(i,Error),i}(),i=function(n){function i(){var n;s(this,i);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return o(this,(n=i.__proto__||Object.getPrototypeOf(i)).call.apply(n,[this].concat(e)))}return r(i,a),i}(),u=function(n){function i(){var n;s(this,i);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return o(this,(n=i.__proto__||Object.getPrototypeOf(i)).call.apply(n,[this].concat(e)))}return r(i,a),i}(),l=function(n){function i(){var n;s(this,i);for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return o(this,(n=i.__proto__||Object.getPrototypeOf(i)).call.apply(n,[this].concat(e)))}return r(i,a),i}();t.exports={NotatrixError:a,InvalidCG3Error:i,InvalidCoNLLUError:u,TransformationError:l}},{}],4:[function(n,t,e){"use strict";t.exports={Error:n("./errors"),Sentence:n("./sentence"),Token:n("./token"),Analysis:n("./analysis")}},{"./analysis":2,"./errors":3,"./sentence":5,"./token":6}],5:[function(n,t,e){"use strict";var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},a=function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return function(n,t){var e=[],r=!0,i=!1,s=void 0;try{for(var o,a=n[Symbol.iterator]();!(r=(o=a.next()).done)&&(e.push(o.value),!t||e.length!==t);r=!0);}catch(n){i=!0,s=n}finally{try{!r&&a.return&&a.return()}finally{if(i)throw s}}return e}(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(){function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}}();var u=n("underscore"),o=n("./errors").NotatrixError,l=n("./errors").InvalidCG3Error,c=n("./errors").InvalidCoNLLUError,f=n("./token"),h=n("./analysis"),p={comment:/^\W*\#/,commentContent:/^\W*\#\W*(.*)/,superToken:/^\W*[0-9.]+\-[0-9.]+/,empty:/^\W*[0-9]+\.[0-9]+/,cg3TokenStart:/^"<(.|\\")*>"/,cg3TokenContent:/^;?\s+"(.|\\")*"/},r=function(){function r(n,t){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),void 0!==t||Array.isArray(n)||(t=n,n=void 0),this.options=u.defaults(t,{help:{form:!0,lemma:!0,upostag:!0,xpostag:!0,head:!0,deps:!0},showEnhanced:!0,showEmptyDependencies:!0,catchInvalid:!0,fallbackOnText:!1}),this.comments=[],this.tokens=[],n&&(this.params=n)}return i(r,[{key:"forEach",value:function(n){for(var t=0,e=0;e<this.tokens.length;e++){var r=this.tokens[e];n(r,t),t++;for(var i=0;i<r.subTokens.length;i++)n(r.subTokens[i],t),t++}return this}},{key:"getIndices",value:function(t){var e=-1,r=-1,i=!1,s=!1;return t.sentence.forEach(function(n){i||(n.isSubToken?(r++,s=!0):(e++,s=!(r=-1)),n===t&&(i=!0))}),-1===e?null:{super:e,sub:s?r:null}}},{key:"getComment",value:function(n){return this.comments[n]||null}},{key:"getToken",value:function(e){var r=null;return this.forEach(function(n,t){t===e&&(r=n)}),r}},{key:"getById",value:function(n){for(var t=0;t<this.tokens.length;t++){var e=this.tokens[t];if(e.analysis.id==n)return e.analysis;for(var r=0;r<e.subTokens.length;r++){var i=e.subTokens[r];if(i.analysis.id==n)return i.analysis}}return null}},{key:"insertTokenBefore",value:function(n,t){if(!(n instanceof f))throw new o("unable to insert token: not instance of Token");t instanceof f||(t=f.fromParams(this,{form:"inserted"}));var e=this.getIndices(n);return null===e?null:null===e.sub?this.insertTokenAt(e.super,t):this[e.super].insertSubTokenAt(e.sub,t)}},{key:"insertTokenAfter",value:function(n,t){if(!(n instanceof f))throw new o("unable to insert token: not instance of Token");t instanceof f||(t=f.fromParams(this,{form:"inserted"}));var e=this.getIndices(n);return null===e?null:null===e.sub?this.insertTokenAt(e.super+1,t):this[e.super].insertSubTokenAt(e.sub+1,t)}},{key:"insertAnalysisBefore",value:function(e,n){if(!(e instanceof h))throw new o("unable to insert analysis: not instance of Analysis");n instanceof h||(n=f.fromParams(this,{form:"inserted"}).analysis);var t=this.getIndices(e.token);if(null===t)return null;var r=null===t.sub?this[t.super].token:this[t.super][t.sub].token,i=-1;return r.forEach(function(n,t){n===e&&(i=t)}),-1<i?r.insertAnalysisAt(i,n):void 0}},{key:"insertAnalysisAfter",value:function(e,n){if(!(e instanceof h))throw new o("unable to insert analysis: not instance of Analysis");n instanceof h||(n=f.fromParams(this,{form:"inserted"}).analysis);var t=this.getIndices(e.token);if(null===t)return null;var r=null===t.sub?this[t.super].token:this[t.super][t.sub].token,i=-1;return r.forEach(function(n,t){n===e&&(i=t)}),-1<i?r.insertAnalysisAt(i+1,n):void 0}},{key:"insertTokenAt",value:function(n,t){if(n=parseFloat(n),isNaN(n))throw new o("unable to insert token: unable to cast index to int");if(!(t instanceof f))throw new o("unable to insert token: not instance of Token");return n=n<0?0:n>this.length?this.length:parseInt(n),this.tokens=this.tokens.slice(0,n).concat(t).concat(this.tokens.slice(n)),this}},{key:"removeTokenAt",value:function(e){var r=this;if(!this.tokens.length)return null;if(e=parseFloat(e),isNaN(e))throw new o("unable to remove token: unable to cast index to int");return e=e<0?0:e>this.tokens.length-1?this.tokens.length-1:parseInt(e),this.forEach(function(t){t.analysis.eachHead(function(n){n===r[e]&&t.analysis.removeHead(n)}).eachDep(function(n){n===r[e]&&t.analysis.removeDep(n)})}),this.tokens.splice(e,1)[0]}},{key:"moveTokenAt",value:function(n,t){if(n=parseFloat(n),t=parseFloat(t),isNaN(n)||isNaN(t))throw new o("unable to move token: unable to cast indices to ints");if((n=n<0?0:n>this.tokens.length-1?this.tokens.length-1:parseInt(n))===(t=t<0?0:t>this.tokens.length-1?this.tokens.length-1:parseInt(t)));else{var e=this.tokens.splice(n,1);this.tokens=this.tokens.slice(0,t).concat(e).concat(this.tokens.slice(t))}return this}},{key:"pushToken",value:function(n){return this.insertTokenAt(1/0,n)}},{key:"popToken",value:function(){return this.removeTokenAt(1/0)}},{key:"clean",value:function(){throw new Error("Sentence::clean is not implemented")}},{key:"index",value:function(){var r=0,i=0,s=0,o=0;return u.each(this.tokens,function(n){var t=n.index(r,i,s,o),e=a(t,4);r=e[0],i=e[1],s=e[2],o=e[3]}),this}},{key:"attach",value:function(){return this.index(),this.forEach(function(n){n.analysis.head=n.analysis.head,n.analysis.deps=n.analysis.deps}),this}},{key:"length",get:function(){var t=0;return this.forEach(function(n){t++}),t}},{key:"progress",get:function(){var t=0,e=0;return this.forEach(function(n){e+=2,n.analysis&&(n.analysis.head&&"_"!==n.analysis.head&&t++,n.analysis.pos&&"_"!==n.analysis.head&&t++,n.analysis.eachHead(function(n){e++,n.deprel&&"_"!==n.deprel&&t++}))}),e?t/e:1}},{key:"nx",get:function(){this.index();for(var n=[],t=0;t<this.tokens.length;t++)n.push(this.tokens[t].nx);return{comments:this.comments,options:this.options,tokens:n}},set:function(n){var t=this;return this.options=n.options,this.comments=n.comments,this.tokens=n.tokens.map(function(n){return f.fromNx(t,n)}),this.attach().nx}},{key:"text",get:function(){var t=[];return this.forEach(function(n){n.isSubToken||n.isEmpty||t.push(n.text)}),t.join(" ")},set:function(n){var t=this;return n=n.trim().replace(/([.,?!]+)$/," $1"),u.map(n.split(/\s/),function(n){t.pushToken(f.fromParams(t,{form:n}))}),this.text}},{key:"conllu",get:function(){var n=u.map(this.comments,function(n){return"# "+n});try{var t=[];return this.forEach(function(n){t.push(n.conllu)}),n.concat(t).join("\n")}catch(n){if(!(n instanceof c&&this.options.catchInvalid))throw n;return null}},set:function(n){this.comments=[],this.tokens=[];for(var t=n.trim().split("\n"),e=0;e<t.length;e++)if(p.comment.test(t[e]))this.comments.push(t[e].match(p.commentContent)[1]);else if(p.superToken.test(t[e])){for(var r=f.fromConllu(this,t[e]),i=e,s=t[e].match(p.superToken)[0].trim().split("-").map(function(n){return parseInt(n)}),o=0;o<=s[1]-s[0];o++)r.analysis.pushSubToken(f.fromConllu(this,t[o+i+1])),e++;this.pushToken(r)}else t[e].trim().length&&this.pushToken(f.fromConllu(this,t[e]));return this.attach().conllu}},{key:"cg3",get:function(){var n=u.map(this.comments,function(n){return"# "+n});try{for(var t=[],e=0;e<this.tokens.length;e++)t.push(this.tokens[e].cg3);return n.concat(t).join("\n")}catch(n){if(!(n instanceof l&&this.options.catchInvalid))throw n;return null}},set:function(n){this.comments=[],this.tokens=[];for(var t=[],e=n.trim().split("\n"),r=0;r<e.length;r++){var i=p.cg3TokenStart.test(e[r]),s=p.cg3TokenContent.test(e[r]);i?(t.length&&this.tokens.push(f.fromCG3(this,t)),t=[e[r]]):t.length&&s?t.push(e[r]):this.comments.push(e[r].match(p.commentContent)[1])}return t.length&&this.tokens.push(f.fromCG3(this,t)),this.attach().cg3}},{key:"params",get:function(){try{var t=[];return this.forEach(function(n){if(n.isSuperToken||n.isSubToken)throw new c;if(n.isAmbiguous)throw new l;t.push(n.params)}),t}catch(n){if(n instanceof c&&this.options.catchInvalid)return console.warn("cannot get params for this sentence: contains MultiWordTokens"),null;if(n instanceof l&&this.options.catchInvalid)return console.warn("cannot get params for this sentence: contains ambiguous analyses"),null;throw n}},set:function(n){var t=this;return n instanceof Array?(this.comments=[],this.tokens=[],u.each(n,function(n){t.tokens.push(f.fromParams(t,n))}),this.attach().params):null}},{key:"eles",get:function(){this.index();var t=[];return u.each(this.tokens,function(n){t=t.concat(n.eles)}),t}},{key:"isValidConllu",get:function(){var t=!0;return this.forEach(function(n){n.isAmbiguous&&(t=!1)}),t}},{key:"isValidCG3",get:function(){return this.forEach(function(n){}),!0}}],[{key:"fromNx",value:function(n,t){var e=new r(t);return e.nx=n,e}},{key:"fromText",value:function(n,t){var e=new r(t);return e.text=n,e}},{key:"fromConllu",value:function(n,t){var e=new r(t);return e.conllu=n,e}},{key:"fromCG3",value:function(n,t){var e=new r(t);return e.cg3=n,e}},{key:"fromParams",value:function(n,t){var e=new r(t);return e.params=n,e}}]),r}();r.prototype.__proto__=new Proxy(r.prototype.__proto__,{get:function(n,t,e){if("symbol"===(void 0===t?"undefined":s(t)))return this[t];var r=parseFloat(t);if(isNaN(r))return this[t];r=parseInt(r);var i=e.tokens[r];return i?i.analysis:null}}),t.exports=r},{"./analysis":2,"./errors":3,"./token":6,underscore:1}],6:[function(n,t,e){"use strict";var i=function(){function r(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(n,t,e){return t&&r(n.prototype,t),e&&r(n,e),n}}();var u=n("underscore"),l=n("./errors").NotatrixError,s=(n("./errors").InvalidCG3Error,n("./errors").InvalidCoNLLUError),a=n("./analysis");function c(n){return(n||"").split(/\s+/)}function o(n){for(var t=n.split(""),e=0;"\t"===t[e++];);return e-1}function f(n){return y.form.test(n)?n.match(y.form)[1]:void 0}function h(n){var t=void 0,e=[],r=void 0,i=void 0,s=[];y.lemma.test(n)&&(t=n.match(y.lemma)[1]);for(var o=c(n=t?n.slice(n.indexOf(t)+t.length+1).trim():n),a=0;a<o.length;a++)y.deprel.test(o[a])?i=o[a].match(y.deprel)[1]:y.id.test(o[a])?r=y.dependency.test(o[a])?o[a].match(y.dependency)[2]:o[a].match(y.head)[1]:y.misc.test(o[a])?s.push(o[a]):"_"!==o[a]&&e.push(o[a]);return{lemma:t,xpostag:e.join(";")||void 0,head:r,deprel:i,deps:void 0,misc:s.join(";")||void 0}}function p(n,t){if(2===t.length){var e=h(t[1]);e.form=f(t[0]),n.pushAnalysis(new a(n,e))}else{for(var r=new a(n,{form:f(t[0])}),i=1;i<t.length;i++){var s=h(t[i]),o=new d(n.sentence,s);r.pushSubToken(o)}n.pushAnalysis(r)}}var y={form:/^"<((.|\\")*)>"/,lemma:/["\]](.*)["\]](\s|$)/,head:/->(\d*)$/,dependency:/^#(\d+)->(\d*)/,id:/^#(\d+)/,deprel:/^@(.*)/,misc:/.+:.*/},d=function(){function r(n,t){if(function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),!n)throw new l("missing required arg: Sentence");this.sentence=n,this.superToken=null,this.analyses=[],this._current=null,this._isEmpty=!1,t&&(this.analysis=new a(this,t))}return i(r,[{key:"forEach",value:function(n){for(var t=0;t<this.length;t++)n(this.analyses[t],t);return this}},{key:"prev",value:function(){return null===this._current?null:(0<this._current&&this._current--,this)}},{key:"next",value:function(){return null===this._current?null:(this._current<this.length-1&&this._current++,this)}},{key:"insertAnalysisAt",value:function(n,t){if(n=parseFloat(n),isNaN(n))throw new l("unable to insert subToken: unable to cast index to int");if(!(t instanceof a))throw new l("unable to insert analysis: not instance of Analysis");return null===this.current&&(this._current=0),n=n<0?0:n>this.length?this.length:parseInt(n),(t.token=this).analyses=this.analyses.slice(0,n).concat(t).concat(this.analyses.slice(n)),this}},{key:"removeAnalysisAt",value:function(n){if(!this.length)return null;if(n=parseFloat(n),isNaN(n))throw new l("unable to remove subToken: unable to cast index to int");return n=n<0?0:n>this.length-1?this.length-1:parseInt(n),this.current>=n&&this.prev(),1===this.length&&(this._current=null),this.analyses.splice(n,1)[0]}},{key:"moveAnalysisAt",value:function(n,t){if(n=parseFloat(n),t=parseFloat(t),isNaN(n)||isNaN(t))throw new l("unable to move analysis: unable to cast indices to ints");if((n=n<0?0:n>this.length-1?this.length-1:parseInt(n))===(t=t<0?0:t>this.length-1?this.length-1:parseInt(t)));else{var e=this.analyses.splice(n,1);this.analyses=this.analyses.slice(0,t).concat(e).concat(this.analyses.slice(t))}return this}},{key:"pushAnalysis",value:function(n){return this.insertAnalysisAt(1/0,n)}},{key:"popAnalysis",value:function(){return this.removeAnalysisAt(1/0)}},{key:"combineWith",value:function(n){}},{key:"mergeWith",value:function(n){if(!(n instanceof r))throw new l("unable to merge: not instance of Token");if(this===n)throw new l("unable to merge: can't merge with self");if(this.isSuperToken||n.isSuperToken)throw new l("unable to merge: can't merge superTokens");if(this.superToken!==n.superToken)throw new l("unable to merge: can't merge tokens with different superTokens");if(1!==Math.abs(this.analysis.clump-n.analysis.clump))throw new l("unable to merge: tokens must be adjacent");if(null===this.analysis||null===n.analysis)throw new l("unable to merge: tokens must have at least one analysis");if(this.analysis.form=(this.analysis.form||"")+(n.analysis.form||"")||null,this.analysis.lemma=(this.analysis.lemma||"")+(n.analysis.lemma||"")||null,this.upostag=this.upostag||n.upostag||null,this.xpostag=this.xpostag||n.xpostag||null,this.feats=this.feats||n.feats||null,this.misc=this.misc||n.misc||null,n.isSubToken){var t=this.sentence.getIndices(n);this.superToken.removeSubTokenAt(t.sub)}else{var e=this.sentence.getIndices(n);this.sentence.removeTokenAt(e.super)}return this.sentence.index(),this}},{key:"split",value:function(){}},{key:"index",value:function(r,i,s,o){var a=this;if(r=parseInt(r),i=parseInt(i),s=parseInt(s),o=parseInt(o),isNaN(r)||isNaN(i)||isNaN(s)||isNaN(o))throw new l("can't index tokens using non-integers, make sure to call Sentence.index()");return null===this.analysis||this.forEach(function(n){if(n.isCurrent)if(a.isSuperToken){a.analysis.num=s,a.analysis.clump=null,s++,u.each(a.analysis.subTokens,function(n){n.isEmpty?(i++,n.analysis.id=r+"."+i):(r++,n.analysis.id=""+r,i=0),n.forEach(function(n){n.num=s,s++,n.clump=o,o++})});var t=a.subTokens[0].analysis,e=a.subTokens[a.analysis.length-1].analysis;a.analysis.id=t.id+"-"+e.id}else a.analysis.num=s,s++,a.analysis.clump=o,o++,a.isEmpty?(i++,a.analysis.id=r+"."+i):(r++,a.analysis.id=""+r,i=0);else a.analysis.num=s,s++,n.id=null,u.each(n.subTokens,function(n){n.analysis.id=null,n.forEach(function(n){a.analysis.num=s,s++})})}),[r,i,s,o]}},{key:"length",get:function(){return this.analyses.length}},{key:"current",get:function(){return this._current},set:function(n){return n=parseInt(n),isNaN(n)||n<0||n>this.length-1||(this._current=n),this.current}},{key:"analysis",get:function(){return null===this.current?null:this.analyses[this.current]},set:function(n){if(!(n instanceof a))throw new l("unable to set analysis: not instance of Analysis");return null===this.analysis?this.insertAnalysisAt(0,n):(n.token=this).analyses[this.current]=n,this}},{key:"subTokens",get:function(){return null===this.analysis?null:this.analysis.subTokens}},{key:"nx",get:function(){var t=[];return this.forEach(function(n){t.push(n.nx)}),{current:this.current,isEmpty:this.isEmpty,analyses:t}},set:function(n){var e=this;this.analyses=n.analyses.map(function(n){var t=a.fromNx(e,n);return t.subTokens=n.subTokens.map(function(n){return r.fromNx(e.sentence,n)}),t}),this.current=n.current,this._isEmpty=n.isEmpty}},{key:"text",get:function(){if(null===this.analysis)throw new l("no analysis to get text for");return this.analysis.text||""}},{key:"conllu",get:function(){if(null===this.analysis)throw new l("no analysis to get CoNLL-U for");if(this.isAmbiguous)throw new s("Token is ambiguous, can't be converted to CoNNL-U");return this.analysis.conllu},set:function(n){var t=c(n);this._isEmpty=/\./.test(t[0]),this.analysis=new a(this,{form:t[1],lemma:t[2],upostag:t[3],xpostag:t[4],feats:t[5],head:t[6],deprel:t[7],deps:t[8],misc:t[9]})}},{key:"cg3",get:function(){if(null===this.analysis)throw new l("no analysis to get CG3 for");return['"<'+this.analysis.form+'>"'].concat(this.analyses.map(function(n){return n.cg3})).join("\n")},set:function(n){for(var t=[n[0]],e=1;e<n.length;e++){var r=n[e];/^;/.test(r)&&(r=r.replace(/^;/,"")),1===o(r)&&1<e&&(p(this,t),t=[n[0]]),t.push(r)}p(this,t)}},{key:"params",get:function(){if(null===this.analysis)throw new l("no analysis to get params for");return this.analysis.params},set:function(n){return this.analysis=new a(this,n),this.params}},{key:"eles",get:function(){var t=[];return this.forEach(function(n){t=t.concat(n.eles)}),t}},{key:"isSubToken",get:function(){return null!==this.superToken}},{key:"isSuperToken",get:function(){return this.analysis?this.analysis.isSuperToken:null}},{key:"isEmpty",get:function(){return this.isSubToken?this.superToken.token.isEmpty:this._isEmpty}},{key:"isAmbiguous",get:function(){return 1<this.length}}],[{key:"fromNx",value:function(n,t){var e=new r(n);return e.nx=t,e}},{key:"fromConllu",value:function(n,t){var e=new r(n);return e.conllu=t,e}},{key:"fromCG3",value:function(n,t){var e=new r(n);return e.cg3=t,e}},{key:"fromParams",value:function(n,t){var e=new r(n);return e.params=t,e}}]),r}();t.exports=d},{"./analysis":2,"./errors":3,underscore:1}]},{},[4])(4)});
//# sourceMappingURL=notatrix.js.map
